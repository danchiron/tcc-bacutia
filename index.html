
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCC Pablo Salvato ‚Äî Petrografia da Bacutia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        crust:   { 50:'#FAF8F6', 100:'#F0ECE7', 200:'#DDD5CB', 300:'#C4B6A6', 400:'#A8947D', 500:'#8D7460', 600:'#6E574A', 700:'#55413A', 800:'#3C2D2B', 900:'#261B1A' },
                        garnet:  { 50:'#FDF2F0', 100:'#F9DDD8', 200:'#F0B3A8', 300:'#E07E6E', 400:'#C9513F', 500:'#9B1B1B', 600:'#7D1515', 700:'#5E1010', 800:'#400A0A', 900:'#2A0505' },
                        melt:    { 50:'#FFFBF0', 100:'#FFF3D6', 200:'#FFE4A3', 300:'#FFD06B', 400:'#FFC13E', 500:'#E8A817', 600:'#B88310', 700:'#896009', 800:'#5B3F05', 900:'#3D2A03' },
                    },
                    fontFamily: {
                        heading: ['"Cormorant Garamond"', 'Georgia', 'serif'],
                        body:    ['"Source Sans 3"', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Source Sans 3', system-ui, sans-serif; }
        h1, h2, h3, h4, h5 { font-family: 'Cormorant Garamond', Georgia, serif; }

        /* Smooth scroll */
        html { scroll-behavior: smooth; }

        /* Tab system */
        .tab-btn { position: relative; transition: all 0.3s ease; }
        .tab-btn::after {
            content: '';
            position: absolute; bottom: 0; left: 50%; width: 0; height: 2px;
            background: #9B1B1B; transition: all 0.3s ease; transform: translateX(-50%);
        }
        .tab-btn.active { color: #9B1B1B; font-weight: 700; }
        .tab-btn.active::after { width: 100%; }
        .tab-btn:not(.active):hover::after { width: 60%; }

        /* Section transitions */
        .view-section { opacity: 0; transform: translateY(12px); transition: all 0.4s ease; }
        .view-section.visible { opacity: 1; transform: translateY(0); }

        /* Chat */
        .chat-bubble { animation: slideUp 0.3s ease; max-width: 88%; }
        .chat-user { background: #F0ECE7; border-radius: 16px 16px 4px 16px; margin-left: auto; }
        .chat-ai { background: #FDF2F0; border-left: 3px solid #9B1B1B; border-radius: 4px 16px 16px 16px; }
        .chat-kids { background: #FFFBF0; border-left: 3px solid #E8A817; border-radius: 4px 16px 16px 16px; }
        @keyframes slideUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
        .typing::after { content:'...'; animation: dots 1.2s infinite; }
        @keyframes dots { 0%{content:'.'} 33%{content:'..'} 66%{content:'...'} }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #F0ECE7;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.03);
            transition: box-shadow 0.3s ease, transform 0.2s ease;
        }
        .card:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.06), 0 8px 24px rgba(0,0,0,0.06); transform: translateY(-1px); }

        /* Mineral table */
        .mineral-table th { background: #3C2D2B; color: white; }
        .mineral-table tr:nth-child(even) { background: #FAF8F6; }

        /* Timeline */
        .timeline-dot { width: 14px; height: 14px; border-radius: 50%; border: 3px solid #9B1B1B; background: white; flex-shrink: 0; z-index: 1; }
        .timeline-line { position: absolute; left: 6px; top: 14px; bottom: 0; width: 2px; background: #DDD5CB; }

        /* Responsive nav scroll */
        .nav-scroll { overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; }
        .nav-scroll::-webkit-scrollbar { display: none; }

        /* Rock canvas glow */
        #rockCanvas { filter: drop-shadow(0 0 8px rgba(155,27,27,0.15)); }

        /* Comic font */
        .font-comic { font-family: 'Comic Sans MS', 'Chalkboard SE', cursive; }

        /* Print-friendly */
        @media print { nav, footer, .chat-container, #ai-debug-toggle, #ai-debug-panel { display: none !important; } }
    </style>
</head>
<body class="bg-crust-50 text-crust-900 flex flex-col min-h-screen">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <header class="relative bg-crust-900 text-white overflow-hidden">
        <div class="absolute inset-0 opacity-[0.04]" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2260%22><path d=%22M30 0L60 30L30 60L0 30Z%22 fill=%22none%22 stroke=%22white%22 stroke-width=%220.5%22/></svg>');"></div>
        <div class="relative container mx-auto px-6 py-12 md:py-16 text-center">
            <p class="text-garnet-300 text-xs md:text-sm font-body uppercase tracking-[0.3em] mb-4">Universidade Federal do Esp√≠rito Santo ‚Äî Departamento de Geologia</p>
            <h1 class="text-3xl md:text-5xl lg:text-6xl font-heading font-bold leading-tight mb-3">
                Caracteriza√ß√£o Petrogr√°fica dos<br class="hidden md:block"> Paragnaisses Migmatizados da Bacutia
            </h1>
            <p class="text-crust-300 text-base md:text-lg font-light max-w-2xl mx-auto mt-4">
                G√™nese e evolu√ß√£o textural da granada na zona de interfer√™ncia entre os Or√≥genos Ara√ßua√≠ e Ribeira, Guarapari-ES
            </p>
            <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-8 text-sm text-crust-200">
                <p>Autor: <span class="font-semibold text-white">Pablo de Oliveira Salvato</span></p>
                <span class="hidden sm:inline text-crust-500">¬∑</span>
                <p>Orienta√ß√£o: <span class="font-semibold text-white">Prof.¬™ Dr.¬™ Marilane Gonzaga de Melo</span></p>
            </div>
            <p class="text-crust-500 text-xs mt-3">2025 ¬∑ Trabalho de Conclus√£o de Curso</p>
        </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-crust-100 shadow-sm">
        <div class="container mx-auto px-4">
            <div class="nav-scroll flex justify-start md:justify-center gap-1 py-1">
                <button onclick="switchTab('general')"     id="tab-general"     class="tab-btn active px-5 py-3 text-sm font-medium whitespace-nowrap">Vis√£o Geral</button>
                <button onclick="switchTab('academic')"    id="tab-academic"    class="tab-btn px-5 py-3 text-sm font-medium whitespace-nowrap">Acad√™mico</button>
                <button onclick="switchTab('petrografia')" id="tab-petrografia" class="tab-btn px-5 py-3 text-sm font-medium whitespace-nowrap">Petrografia</button>
                <button onclick="switchTab('kids')"        id="tab-kids"        class="tab-btn px-5 py-3 text-sm font-medium whitespace-nowrap">Interativo</button>
                <button onclick="switchTab('infografico')" id="tab-infografico" class="tab-btn px-5 py-3 text-sm font-medium whitespace-nowrap">Infogr√°fico</button>
                <button onclick="switchTab('galeria')"     id="tab-galeria"     class="tab-btn px-5 py-3 text-sm font-medium whitespace-nowrap">Galeria</button>
            </div>
        </div>
    </nav>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <main class="flex-grow">

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VIS√ÉO GERAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="view-general" class="view-section visible">
        <div class="container mx-auto px-4 sm:px-6 py-10 md:py-14 space-y-12">

            <!-- Hero text -->
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-heading font-bold text-crust-800 mb-5">A Ci√™ncia por tr√°s da Beleza</h2>
                <p class="text-lg text-crust-600 leading-relaxed">
                    A Praia da Bacutia n√£o √© s√≥ cen√°rio de f√©rias: √© uma cicatriz geol√≥gica da colis√£o entre continentes que ergueu, no Neoproterozoico, uma cadeia de montanhas colossal no leste do Brasil.
                </p>
            </div>

            <!-- Three pillars -->
            <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
                <div class="card p-6 text-center border-t-4 border-garnet-500">
                    <div class="w-14 h-14 mx-auto mb-4 bg-garnet-50 text-garnet-500 rounded-xl flex items-center justify-center text-2xl">üèîÔ∏è</div>
                    <h3 class="font-heading text-xl font-bold text-crust-800 mb-2">Origem</h3>
                    <p class="text-sm text-crust-600">Sedimentos depositados em bacia oce√¢nica foram soterrados durante a converg√™ncia dos Or√≥genos Ara√ßua√≠ e Ribeira, atingindo profundidades crustais de ~25 km.</p>
                </div>
                <div class="card p-6 text-center border-t-4 border-melt-500">
                    <div class="w-14 h-14 mx-auto mb-4 bg-melt-50 text-melt-600 rounded-xl flex items-center justify-center text-2xl">üî•</div>
                    <h3 class="font-heading text-xl font-bold text-crust-800 mb-2">Transforma√ß√£o</h3>
                    <p class="text-sm text-crust-600">A ~800 ¬∞C e 7,5 kbar, a biotita se decomp√¥s gerando fus√£o parcial (anatexia). Nasceram as granadas ‚Äî os "cristais-registro" de toda essa hist√≥ria.</p>
                </div>
                <div class="card p-6 text-center border-t-4 border-crust-400">
                    <div class="w-14 h-14 mx-auto mb-4 bg-crust-100 text-crust-600 rounded-xl flex items-center justify-center text-2xl">üíé</div>
                    <h3 class="font-heading text-xl font-bold text-crust-800 mb-2">Revela√ß√£o</h3>
                    <p class="text-sm text-crust-600">Milh√µes de anos depois, a exuma√ß√£o e a eros√£o trouxeram essas rochas √† superf√≠cie ‚Äî hoje expostas entre o mar, o sol e a areia de Guarapari.</p>
                </div>
            </div>

            <!-- Video + Timeline -->
            <div class="grid lg:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <div class="card p-5">
                    <h3 class="font-heading text-xl font-bold text-crust-800 mb-3">Apresenta√ß√£o do TCC</h3>
                    <div class="relative w-full overflow-hidden rounded-lg bg-crust-100" style="padding-top: 56.25%;">
                        <iframe class="absolute top-0 left-0 w-full h-full"
                            src="https://drive.google.com/file/d/1EQX99wclcQy_10unqbkrfTINQu24w8AN/preview"
                            title="Apresenta√ß√£o do TCC" allow="autoplay" loading="lazy"></iframe>
                    </div>
                    <p class="text-xs text-crust-400 mt-3 text-center">Defesa do TCC ‚Äî UFES, 2025</p>
                </div>

                <div class="card p-6">
                    <h3 class="font-heading text-xl font-bold text-crust-800 mb-6">Jornada da Rocha</h3>
                    <div class="space-y-6">
                        <div class="flex gap-4 items-start">
                            <div class="bg-crust-200 text-crust-700 w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold">1</div>
                            <div><p class="font-semibold text-crust-800">Deposi√ß√£o sedimentar</p><p class="text-sm text-crust-500 mt-0.5">Argilas e areias acumulam-se em uma bacia oce√¢nica neoproterozoica.</p></div>
                        </div>
                        <div class="flex gap-4 items-start">
                            <div class="bg-melt-200 text-melt-700 w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold">2</div>
                            <div><p class="font-semibold text-crust-800">Metamorfismo progressivo</p><p class="text-sm text-crust-500 mt-0.5">Soterramento e converg√™ncia elevam temperatura e press√£o. A rocha se recristaliza.</p></div>
                        </div>
                        <div class="flex gap-4 items-start">
                            <div class="bg-garnet-200 text-garnet-700 w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold">3</div>
                            <div><p class="font-semibold text-crust-800">Anatexia (fus√£o parcial)</p><p class="text-sm text-crust-500 mt-0.5">Bt + Qtz + Pl ‚Üí Grt‚ÇÅ + Kfs + Melt. A rocha come√ßa a fundir, gerando migmatitos.</p></div>
                        </div>
                        <div class="flex gap-4 items-start">
                            <div class="bg-garnet-100 text-garnet-500 w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold">4</div>
                            <div><p class="font-semibold text-crust-800">Cristaliza√ß√£o e retrometamorfismo</p><p class="text-sm text-crust-500 mt-0.5">Grt‚ÇÇ cristaliza no leucossoma. Cordierita retrograda indica descompress√£o.</p></div>
                        </div>
                        <div class="flex gap-4 items-start">
                            <div class="bg-crust-100 text-crust-500 w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold">5</div>
                            <div><p class="font-semibold text-crust-800">Exuma√ß√£o e exposi√ß√£o</p><p class="text-sm text-crust-500 mt-0.5">Eros√£o traz as rochas de ~25 km de profundidade √† superf√≠cie na Praia da Bacutia.</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key findings -->
            <div class="max-w-5xl mx-auto card p-6 md:p-8 border-l-4 border-garnet-500">
                <h3 class="font-heading text-2xl font-bold text-crust-800 mb-4">Principais Descobertas</h3>
                <div class="grid md:grid-cols-2 gap-6 text-sm text-crust-700">
                    <div>
                        <p class="font-semibold text-garnet-600 mb-1">Duas gera√ß√µes de granada</p>
                        <p><strong>Grt‚ÇÅ</strong> ‚Äî poiquilobl√°stica, com inclus√µes de Qtz, Bt e opacos, ocorre no paleossoma. Registra crescimento pr√≥grado.</p>
                        <p class="mt-2"><strong>Grt‚ÇÇ</strong> ‚Äî limpa, sem inclus√µes, idiobl√°stica a subidiobl√°stica, ocorre no leucossoma. Cristalizada a partir do melt.</p>
                    </div>
                    <div>
                        <p class="font-semibold text-garnet-600 mb-1">Tr√™s gera√ß√µes de biotita</p>
                        <p><strong>Bt‚ÇÅ</strong> ‚Äî inclus√µes arredondadas em granada.</p>
                        <p><strong>Bt‚ÇÇ</strong> ‚Äî define a folia√ß√£o no melanossoma.</p>
                        <p><strong>Bt‚ÇÉ</strong> ‚Äî substitui bordas da granada (retrometamorfismo).</p>
                        <p class="mt-2"><strong>Cordierita pinitizada</strong> ‚Äî com bordas de altera√ß√£o amarelada, marca descompress√£o p√≥s-pico.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ACAD√äMICO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="view-academic" class="view-section hidden">
        <div class="container mx-auto px-4 sm:px-6 py-10 md:py-14 space-y-10">

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-8">

                    <!-- Resumo -->
                    <div class="card p-6 md:p-8 border-l-4 border-garnet-500">
                        <h3 class="font-heading text-2xl font-bold text-crust-800 mb-4">Resumo</h3>
                        <p class="text-crust-700 text-justify leading-relaxed">
                            Os paragnaisses migmatizados da Praia da Bacutia, Guarapari-ES, inseridos na zona de interfer√™ncia entre os Or√≥genos Ara√ßua√≠ e Ribeira (Prov√≠ncia Mantiqueira), registram processos de anatexia em f√°cies granulito. O estudo petrogr√°fico identificou fus√£o parcial por desidrata√ß√£o da biotita (<strong>Bt + Qtz + Pl ‚Üí Grt + Kfs + Melt</strong>), com pico metam√≥rfico estimado em ~800‚Äì850 ¬∞C e ~7,5 kbar. Foram reconhecidas duas gera√ß√µes texturalmente distintas de granada: <strong>Grt‚ÇÅ</strong> (poiquilobl√°stica, com inclus√µes no paleossoma) e <strong>Grt‚ÇÇ</strong> (limpa, no leucossoma), al√©m de cordierita pinitizada como registro da trajet√≥ria retr√≥grada de descompress√£o.
                        </p>
                    </div>

                    <!-- Narrativa -->
                    <div class="card p-6 md:p-8">
                        <h3 class="font-heading text-2xl font-bold text-crust-800 mb-4">Narrativa Petrogen√©tica</h3>
                        <div class="space-y-4 text-crust-700 text-justify leading-relaxed">
                            <p>
                                O prot√≥lito pel√≠tico dos paragnaisses da Bacutia foi progressivamente soterrado durante a converg√™ncia neoproterozoica associada ao Or√≥geno Ara√ßua√≠. O aumento acoplado de temperatura e press√£o levou √† desestabiliza√ß√£o da biotita, promovendo fus√£o parcial por desidrata√ß√£o e gera√ß√£o de melt silic√°tico, K-feldspato e granada.
                            </p>
                            <p>
                                Nesse est√°gio, a granada <strong>Grt‚ÇÅ</strong> registra inclus√µes minerais e microestruturas herdadas da matriz, compat√≠veis com crescimento pr√≥grado em ambiente de alto grau. A condi√ß√£o de pico, em ~800‚Äì850 ¬∞C e ~7,5 kbar, indica metamorfismo em f√°cies granulito em profundidades crustais intermedi√°rias (~25 km).
                            </p>
                            <p>
                                Ap√≥s o √°pice t√©rmico, o sistema evoluiu para exuma√ß√£o e resfriamento, com cristaliza√ß√£o progressiva do melt remanescente e reequil√≠brios texturais. A granada <strong>Grt‚ÇÇ</strong> ocorre mais limpa, com menor carga de inclus√µes, refletindo est√°gios tardios de crescimento e/ou recristaliza√ß√£o a partir do melt.
                            </p>
                            <p>
                                Na trajet√≥ria retr√≥grada, a forma√ß√£o de coroas e bordas de <strong>cordierita</strong> ao redor da granada expressa descompress√£o e hidrata√ß√£o relativa do sistema. A associa√ß√£o Grt‚ÄìBt‚ÄìSil com Crd retrograda preserva um registro integrado de aquecimento colisional, anatexia e evolu√ß√£o p√≥s-pico.
                            </p>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="card p-5">
                            <h4 class="font-heading text-lg font-bold text-crust-700 mb-3 text-center">Evolu√ß√£o Mineral</h4>
                            <div style="height:320px"><canvas id="mineralChart"></canvas></div>
                        </div>
                        <div class="card p-5">
                            <h4 class="font-heading text-lg font-bold text-crust-700 mb-3 text-center">Trajet√≥ria P-T</h4>
                            <div style="height:320px"><canvas id="ptPathChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Structural data -->
                    <div class="card p-6">
                        <h3 class="font-heading text-xl font-bold text-crust-800 mb-4">Estruturas de Migmatito Identificadas</h3>
                        <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-3">
                            <div class="bg-crust-50 rounded-lg p-3 border border-crust-100">
                                <p class="font-semibold text-sm text-crust-800">Estrom√°tica</p>
                                <p class="text-xs text-crust-500 mt-1">Bandamento composicional alternando leucossoma e melanossoma</p>
                            </div>
                            <div class="bg-crust-50 rounded-lg p-3 border border-crust-100">
                                <p class="font-semibold text-sm text-crust-800">Schollen</p>
                                <p class="text-xs text-crust-500 mt-1">Fragmentos de paleossoma envoltos em neossoma</p>
                            </div>
                            <div class="bg-crust-50 rounded-lg p-3 border border-crust-100">
                                <p class="font-semibold text-sm text-crust-800">Schlieren</p>
                                <p class="text-xs text-crust-500 mt-1">Alinhamento de minerais m√°ficos orientados pelo fluxo</p>
                            </div>
                            <div class="bg-crust-50 rounded-lg p-3 border border-crust-100">
                                <p class="font-semibold text-sm text-crust-800">Bols√µes</p>
                                <p class="text-xs text-crust-500 mt-1">Acumula√ß√µes irregulares de leucossoma</p>
                            </div>
                            <div class="bg-crust-50 rounded-lg p-3 border border-crust-100">
                                <p class="font-semibold text-sm text-crust-800">Dobras ptigm√°ticas</p>
                                <p class="text-xs text-crust-500 mt-1">Veios de Qtz-Fsp intensamente dobrados</p>
                            </div>
                            <div class="bg-crust-50 rounded-lg p-3 border border-crust-100">
                                <p class="font-semibold text-sm text-crust-800">Em rede</p>
                                <p class="text-xs text-crust-500 mt-1">Leucossoma formando rede interconectada</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat acad√™mico -->
                <div class="card p-4 flex flex-col h-[680px] lg:sticky lg:top-20">
                    <div class="flex items-center gap-3 mb-4 pb-3 border-b border-crust-100">
                        <div class="w-10 h-10 bg-garnet-500 rounded-lg flex items-center justify-center text-white text-lg">üî¨</div>
                        <div>
                            <h4 class="font-heading font-bold text-crust-800">Chat Acad√™mico</h4>
                            <p class="text-xs text-crust-400">D√∫vidas t√©cnicas sobre o TCC</p>
                        </div>
                    </div>
                    <div id="academic-chat-output" class="flex-grow overflow-y-auto flex flex-col gap-3 text-sm mb-4 pr-1">
                        <div class="chat-bubble chat-ai p-3">Ol√°! Pergunte sobre o TCC ‚Äî petrografia, condi√ß√µes P-T, rea√ß√µes metam√≥rficas ou qualquer outro aspecto t√©cnico.</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="academic-chat-input" placeholder="Ex: O que diferencia Grt‚ÇÅ de Grt‚ÇÇ?" class="flex-grow p-3 rounded-xl border border-crust-200 bg-crust-50 text-sm focus:outline-none focus:border-garnet-300 focus:ring-1 focus:ring-garnet-200" onkeypress="handleEnter(event, 'academic')">
                        <button onclick="askGemini('academic')" class="bg-garnet-500 hover:bg-garnet-600 text-white w-11 h-11 rounded-xl flex items-center justify-center transition-colors" aria-label="Enviar">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PETROGRAFIA (NOVA SE√á√ÉO) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="view-petrografia" class="view-section hidden">
        <div class="container mx-auto px-4 sm:px-6 py-10 md:py-14 space-y-10">
            <div class="max-w-4xl mx-auto text-center mb-2">
                <h2 class="text-3xl md:text-4xl font-heading font-bold text-crust-800 mb-3">Descri√ß√£o Petrogr√°fica</h2>
                <p class="text-crust-500">Mineralogia e texturas identificadas nas l√¢minas delgadas dos paragnaisses migmatizados</p>
            </div>

            <!-- Mineral table -->
            <div class="max-w-5xl mx-auto card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="mineral-table w-full text-sm">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 text-left font-semibold">Mineral</th>
                                <th class="px-4 py-3 text-left font-semibold">S√≠mbolo</th>
                                <th class="px-4 py-3 text-left font-semibold">Abund√¢ncia</th>
                                <th class="px-4 py-3 text-left font-semibold">Granula√ß√£o</th>
                                <th class="px-4 py-3 text-left font-semibold">Forma</th>
                                <th class="px-4 py-3 text-left font-semibold">Observa√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody class="text-crust-700">
                            <tr><td class="px-4 py-2.5 font-medium">Quartzo</td><td class="px-4 py-2.5">Qtz</td><td class="px-4 py-2.5">~40%</td><td class="px-4 py-2.5">Fina a m√©dia</td><td class="px-4 py-2.5">Xenobl√°stico</td><td class="px-4 py-2.5">Extin√ß√£o ondulante; filmes com contatos ameboides; inclus√µes de zirc√£o</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">Ortocl√°sio</td><td class="px-4 py-2.5">Or</td><td class="px-4 py-2.5">~20%</td><td class="px-4 py-2.5">Fina a m√©dia</td><td class="px-4 py-2.5">Xenobl√°stico</td><td class="px-4 py-2.5">Clivagens (001):(010) a 90¬∞; pertitas; sericitiza√ß√£o parcial</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">Plagiocl√°sio</td><td class="px-4 py-2.5">Pl</td><td class="px-4 py-2.5">~15%</td><td class="px-4 py-2.5">Fina a m√©dia</td><td class="px-4 py-2.5">Xeno- a subidiobl√°stico</td><td class="px-4 py-2.5">Macla polissint√©tica; gemina√ß√£o de deforma√ß√£o; inclus√µes de zirc√£o</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">Biotita</td><td class="px-4 py-2.5">Bt</td><td class="px-4 py-2.5">~15%</td><td class="px-4 py-2.5">Fina a m√©dia</td><td class="px-4 py-2.5">Idio- a xenobl√°stico</td><td class="px-4 py-2.5">3 gera√ß√µes: Bt‚ÇÅ (inclus√µes em Grt), Bt‚ÇÇ (folia√ß√£o), Bt‚ÇÉ (bordas de Grt)</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium text-garnet-600">Granada</td><td class="px-4 py-2.5 text-garnet-600">Grt</td><td class="px-4 py-2.5">~9%</td><td class="px-4 py-2.5">M√©dia a grossa</td><td class="px-4 py-2.5">Sub- a idiobl√°stico</td><td class="px-4 py-2.5 text-garnet-700 font-medium">Grt‚ÇÅ: poiquilobl√°stica c/ inclus√µes ¬∑ Grt‚ÇÇ: limpa, no leucossoma</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">Cordierita</td><td class="px-4 py-2.5">Crd</td><td class="px-4 py-2.5">&lt;1%</td><td class="px-4 py-2.5">Fina</td><td class="px-4 py-2.5">Idiobl√°stico</td><td class="px-4 py-2.5">Pinitizada; macla cunha quando preservada; colora√ß√£o amarelada</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">Acess√≥rios</td><td class="px-4 py-2.5">Zrn, Ap, Opq</td><td class="px-4 py-2.5">&lt;1%</td><td class="px-4 py-2.5">Fina</td><td class="px-4 py-2.5">Idio- a subidiobl√°stico</td><td class="px-4 py-2.5">Dispersos na matriz e como inclus√µes em Grt e Qtz</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Granada details -->
            <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <div class="card p-6 border-l-4 border-garnet-500">
                    <h3 class="font-heading text-xl font-bold text-garnet-600 mb-4">Granada Grt‚ÇÅ ‚Äî Pr√≥grada</h3>
                    <div class="space-y-3 text-sm text-crust-700">
                        <p><strong>Localiza√ß√£o:</strong> Preferencialmente no paleossoma (melanossoma)</p>
                        <p><strong>Tamanho:</strong> 1,25 mm a 2,5 mm (granula√ß√£o m√©dia a grossa)</p>
                        <p><strong>Forma:</strong> Subidiobl√°stica a xenobl√°stica, poiquilobl√°stica</p>
                        <p><strong>Inclus√µes:</strong> Quartzo (lobadas a arredondadas), biotita (Bt‚ÇÅ), apatita e minerais opacos</p>
                        <p><strong>Fraturas:</strong> Muito fraturada; fraturas eventualmente preenchidas por Bt‚ÇÉ</p>
                        <p><strong>Interpreta√ß√£o:</strong> Crescimento pr√≥grado contempor√¢neo √† fus√£o parcial. As inclus√µes representam minerais do prot√≥lito englobados durante o crescimento em alta temperatura.</p>
                    </div>
                </div>
                <div class="card p-6 border-l-4 border-melt-500">
                    <h3 class="font-heading text-xl font-bold text-melt-600 mb-4">Granada Grt‚ÇÇ ‚Äî do Leucossoma</h3>
                    <div class="space-y-3 text-sm text-crust-700">
                        <p><strong>Localiza√ß√£o:</strong> Predominantemente no leucossoma (neossoma)</p>
                        <p><strong>Tamanho:</strong> 0,5 mm a 1,75 mm (granula√ß√£o fina a m√©dia)</p>
                        <p><strong>Forma:</strong> Subidiobl√°stica a idiobl√°stica</p>
                        <p><strong>Inclus√µes:</strong> Ausentes ou muito raras</p>
                        <p><strong>Fraturas:</strong> Presentes mas menos intensas que Grt‚ÇÅ</p>
                        <p><strong>Interpreta√ß√£o:</strong> Cristaliza√ß√£o tardia a partir do melt. A aus√™ncia de inclus√µes indica crescimento em ambiente l√≠quido, n√£o na matriz rochosa s√≥lida.</p>
                    </div>
                </div>
            </div>

            <!-- Reactions -->
            <div class="max-w-5xl mx-auto card p-6 md:p-8">
                <h3 class="font-heading text-xl font-bold text-crust-800 mb-6">Rea√ß√µes Metam√≥rficas</h3>
                <div class="space-y-6">
                    <div class="bg-garnet-50 border border-garnet-100 rounded-xl p-5">
                        <p class="text-xs text-garnet-400 uppercase tracking-wider font-semibold mb-2">Fus√£o por desidrata√ß√£o ‚Äî Pico metam√≥rfico</p>
                        <p class="font-heading text-xl md:text-2xl text-garnet-700 font-bold">Bt + Qtz + Pl ‚Üí Grt + Kfs + Melt</p>
                        <p class="text-sm text-crust-600 mt-2">~800‚Äì850 ¬∞C / ~7,5 kbar ¬∑ F√°cies granulito ¬∑ ~25 km de profundidade</p>
                    </div>
                    <div class="bg-crust-50 border border-crust-200 rounded-xl p-5">
                        <p class="text-xs text-crust-400 uppercase tracking-wider font-semibold mb-2">Retrometamorfismo ‚Äî Descompress√£o</p>
                        <p class="font-heading text-xl md:text-2xl text-crust-700 font-bold">Grt + Sil + Qtz ‚Üí Crd ¬± Bt</p>
                        <p class="text-sm text-crust-600 mt-2">Trajet√≥ria hor√°ria de descompress√£o com resfriamento ¬∑ Forma√ß√£o de cordierita pinitizada</p>
                    </div>
                </div>
            </div>

            <!-- Field data summary -->
            <div class="max-w-5xl mx-auto card overflow-hidden">
                <div class="p-6 border-b border-crust-100">
                    <h3 class="font-heading text-xl font-bold text-crust-800">Pontos Descritos em Campo</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="mineral-table w-full text-sm">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 text-left">Ponto</th>
                                <th class="px-4 py-3 text-left">Rocha</th>
                                <th class="px-4 py-3 text-left">Granada</th>
                                <th class="px-4 py-3 text-left">Cordierita</th>
                                <th class="px-4 py-3 text-left">Estruturas</th>
                            </tr>
                        </thead>
                        <tbody class="text-crust-700">
                            <tr><td class="px-4 py-2.5 font-medium">PS01.1</td><td class="px-4 py-2.5">Paragnaisse migmatizado</td><td class="px-4 py-2.5">Milim√©trica (neossoma)</td><td class="px-4 py-2.5">Pinitizada</td><td class="px-4 py-2.5">Bols√µes, estrom√°tica</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">PS01.2</td><td class="px-4 py-2.5">Paragnaisse migmatizado</td><td class="px-4 py-2.5">Com/sem inclus√µes</td><td class="px-4 py-2.5">Idiobl√°stica</td><td class="px-4 py-2.5">Schollen</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">PS02</td><td class="px-4 py-2.5">Paragnaisse migmatizado</td><td class="px-4 py-2.5">Centim√©trica (paleossoma)</td><td class="px-4 py-2.5">Presente</td><td class="px-4 py-2.5">Schlieren</td></tr>
                            <tr><td class="px-4 py-2.5 font-medium">PS03</td><td class="px-4 py-2.5">Paragnaisse migmatizado</td><td class="px-4 py-2.5">Inclus√µes pr√≥gradas</td><td class="px-4 py-2.5">A confirmar</td><td class="px-4 py-2.5">Estrom√°tica, rede</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INTERATIVO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="view-kids" class="view-section hidden">
        <div class="container mx-auto px-4 sm:px-6 py-10 md:py-14 space-y-10">
            <div class="grid lg:grid-cols-3 gap-8">

                <!-- Lab -->
                <div class="lg:col-span-2 card p-6 md:p-8">
                    <h2 class="font-heading text-2xl font-bold text-crust-800 text-center mb-6">Laborat√≥rio de Rochas</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-crust-700 mb-2">Temperatura</label>
                                <input type="range" id="tempSlider" min="1" max="100" value="10" class="w-full accent-garnet-500" oninput="updateRock()">
                                <p class="text-xs text-crust-500 mt-1">Escala: <span id="tempValue" class="font-bold text-crust-800">260</span> ¬∞C</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-crust-700 mb-2">Press√£o</label>
                                <input type="range" id="pressSlider" min="1" max="100" value="10" class="w-full accent-crust-500" oninput="updateRock()">
                                <p class="text-xs text-crust-500 mt-1">Escala: <span id="pressValue" class="font-bold text-crust-800">1.7</span> kbar</p>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setRockPreset('low')"    class="bg-crust-100 hover:bg-crust-200 px-3 py-2 rounded-lg text-xs font-medium transition-colors">Baixo grau</button>
                                <button onclick="setRockPreset('medium')" class="bg-melt-100 hover:bg-melt-200 px-3 py-2 rounded-lg text-xs font-medium transition-colors">M√©dio grau</button>
                                <button onclick="setRockPreset('peak')"   class="bg-garnet-100 hover:bg-garnet-200 px-3 py-2 rounded-lg text-xs font-medium text-garnet-700 transition-colors">Pico Bacutia</button>
                                <button onclick="setRockPreset('retro')"  class="bg-blue-50 hover:bg-blue-100 px-3 py-2 rounded-lg text-xs font-medium transition-colors">Retrograda√ß√£o</button>
                            </div>
                            <div class="bg-crust-50 p-4 rounded-xl border border-crust-100">
                                <h4 class="font-semibold text-sm text-crust-800" id="rock-status-title">Lama do Mar</h4>
                                <p class="text-xs text-crust-500 mt-1" id="rock-status-desc">Arraste os controles!</p>
                                <div class="mt-3">
                                    <p class="text-[10px] uppercase tracking-wider text-crust-400 font-semibold">Fra√ß√£o de fus√£o parcial</p>
                                    <div class="w-full bg-crust-100 rounded-full h-2.5 mt-1 overflow-hidden">
                                        <div id="meltBar" class="h-2.5 bg-gradient-to-r from-melt-300 to-garnet-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                    <p class="text-[10px] mt-1 text-crust-500" id="meltText">0% de melt</p>
                                </div>
                            </div>
                            <p class="text-[10px] text-crust-400 leading-relaxed">
                                Modelo educativo inspirado em trajet√≥rias P-T de metamorfismo regional e na condi√ß√£o de pico reportada no TCC (~800 ¬∞C / 7,5 kbar).
                            </p>
                        </div>
                        <div class="flex items-center justify-center">
                            <canvas id="rockCanvas" width="250" height="250" class="rounded-full bg-crust-50"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Dona Granada chat -->
                <div class="card p-4 flex flex-col h-[600px] bg-melt-50 border-2 border-melt-200">
                    <div class="text-center mb-4 pb-3 border-b border-melt-200">
                        <div class="w-14 h-14 bg-garnet-500 rounded-full mx-auto flex items-center justify-center text-2xl text-white shadow-lg shadow-garnet-500/20">üëµ</div>
                        <h4 class="font-heading font-bold text-garnet-600 mt-2 text-lg">Dona Granada</h4>
                        <p class="text-xs text-crust-400">600 milh√µes de anos e contando!</p>
                    </div>
                    <div id="kids-chat-output" class="flex-grow overflow-y-auto flex flex-col gap-3 mb-4 font-comic text-sm pr-1">
                        <div class="chat-bubble chat-kids p-3">Ol√°! Sou a Dona Granada. üëµüî• Pergunte qualquer coisa sobre as rochas da Bacutia, meu pedregulho!</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="kids-chat-input" placeholder="Diz ol√° pra Dona Granada!" class="flex-grow p-3 rounded-full border-2 border-melt-300 bg-white focus:outline-none focus:border-garnet-300 font-comic text-sm" onkeypress="handleEnter(event, 'kids')">
                        <button onclick="askGemini('kids')" class="bg-garnet-500 hover:bg-garnet-600 text-white w-11 h-11 rounded-full font-bold shadow-lg transition-colors" aria-label="Enviar">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INFOGR√ÅFICO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="view-infografico" class="view-section hidden">
        <div class="container mx-auto px-4 sm:px-6 py-10 md:py-14">
            <div class="max-w-5xl mx-auto card p-6 md:p-8">
                <h2 class="text-3xl font-heading font-bold text-crust-800 text-center mb-2">Infogr√°fico</h2>
                <p class="text-center text-crust-500 mb-8">Anatexia em destaque</p>
                <div id="infografico-gallery" class="space-y-6"></div>
                <div class="mt-8 grid gap-4 md:grid-cols-3">
                    <div class="bg-crust-50 rounded-xl p-4 border border-crust-100">
                        <p class="text-xs text-garnet-500 uppercase font-semibold tracking-wider mb-1">1. Prot√≥lito</p>
                        <p class="text-sm text-crust-700">Areia + argila no fundo do mar, ainda sem virar rocha dura.</p>
                    </div>
                    <div class="bg-garnet-50 rounded-xl p-4 border border-garnet-100">
                        <p class="text-xs text-garnet-500 uppercase font-semibold tracking-wider mb-1">2. Pico / Fus√£o</p>
                        <p class="text-sm text-crust-700">A ~800 ¬∞C, a biotita se decomp√¥s e gerou melt + granada.</p>
                    </div>
                    <div class="bg-green-50 rounded-xl p-4 border border-green-100">
                        <p class="text-xs text-green-600 uppercase font-semibold tracking-wider mb-1">3. Retrometamorfismo</p>
                        <p class="text-sm text-crust-700">No resfriamento e subida, a press√£o caiu e surgiu cordierita.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GALERIA (NOVA SE√á√ÉO) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section id="view-galeria" class="view-section hidden">
        <div class="container mx-auto px-4 sm:px-6 py-10 md:py-14 space-y-10">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-heading font-bold text-crust-800 mb-3">Galeria</h2>
                <p class="text-crust-500">Registro fotogr√°fico de campo e fotomicrografias das l√¢minas delgadas</p>
            </div>

            <!-- Localiza√ß√£o -->
            <div class="max-w-5xl mx-auto card p-6">
                <h3 class="font-heading text-xl font-bold text-crust-800 mb-4">Localiza√ß√£o</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="text-sm text-crust-700 space-y-2">
                        <p><strong>Local:</strong> Praia da Bacutia, Guarapari-ES</p>
                        <p><strong>Coordenadas UTM:</strong> 340892E / 7706359N</p>
                        <p><strong>Contexto:</strong> Zona de interfer√™ncia entre os Or√≥genos Ara√ßua√≠ e Ribeira, Prov√≠ncia Mantiqueira</p>
                        <p><strong>Unidade geol√≥gica:</strong> Complexo Nova Ven√©cia (CNV)</p>
                        <p><strong>Litotipo:</strong> Granada paragnaisse migmatizado</p>
                    </div>
                    <div class="bg-crust-100 rounded-xl flex items-center justify-center min-h-[200px] text-crust-400 text-sm">
                        <div class="text-center p-4">
                            <p class="text-4xl mb-2">üìç</p>
                            <p>Mapa da √°rea de estudo</p>
                            <p class="text-xs mt-1">(Consulte as figuras no TCC)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Methodology flowchart -->
            <div class="max-w-5xl mx-auto card p-6 md:p-8">
                <h3 class="font-heading text-xl font-bold text-crust-800 mb-6 text-center">Metodologia</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto bg-crust-100 rounded-2xl flex items-center justify-center text-2xl mb-3">üìö</div>
                        <h4 class="font-semibold text-sm text-crust-800 mb-2">Pr√©-Campo</h4>
                        <p class="text-xs text-crust-500">Sele√ß√£o da √°rea de estudo e revis√£o bibliogr√°fica sobre contexto geotect√¥nico, migmatitos e granada</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto bg-melt-100 rounded-2xl flex items-center justify-center text-2xl mb-3">üî®</div>
                        <h4 class="font-semibold text-sm text-crust-800 mb-2">Campo</h4>
                        <p class="text-xs text-crust-500">Descri√ß√£o de afloramentos, coleta de amostras, medidas estruturais (47 folia√ß√µes, 12 linea√ß√µes) e registro fotogr√°fico</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto bg-garnet-100 rounded-2xl flex items-center justify-center text-2xl mb-3">üî¨</div>
                        <h4 class="font-semibold text-sm text-crust-800 mb-2">P√≥s-Campo</h4>
                        <p class="text-xs text-crust-500">Confec√ß√£o de l√¢minas (Tectus J√∫nior), descri√ß√£o petrogr√°fica no microsc√≥pio Nikon Eclipse E200, integra√ß√£o dos dados</p>
                    </div>
                </div>
            </div>

            <!-- References -->
            <div class="max-w-5xl mx-auto card p-6">
                <h3 class="font-heading text-xl font-bold text-crust-800 mb-4">Refer√™ncias Principais</h3>
                <div class="text-sm text-crust-600 space-y-2">
                    <p>Sawyer, E.W. (2008). <em>Atlas of Migmatites</em>. NRC Research Press.</p>
                    <p>Mehnert, K.R. (1971). <em>Migmatites and the Origin of Granitic Rocks</em>. Elsevier.</p>
                    <p>Richter, F. et al. (2016). Petrological and geochronological constraints on the P-T-t path of the Nova Ven√©cia Complex.</p>
                    <p>Warr, L.N. (2021). IMA‚ÄìCNMNC approved mineral symbols. <em>Mineralogical Magazine</em>, 85(3), 291‚Äì320.</p>
                    <p>Tonolli, L. (2025). Monografia sobre migmatitos do Complexo Nova Ven√©cia, UFES.</p>
                </div>
            </div>
        </div>
    </section>

    </main>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <footer class="bg-crust-900 text-crust-300 py-10 border-t-2 border-garnet-500">
        <div class="container mx-auto px-6 text-center">
            <p class="font-heading text-lg font-bold text-white mb-1">UFES ‚Äî Departamento de Geologia</p>
            <p class="text-xs text-crust-500 mt-2">Universidade Federal do Esp√≠rito Santo ¬∑ Centro de Ci√™ncias Exatas, Naturais e da Sa√∫de</p>
            <p class="text-xs text-crust-600 mt-3">&copy; 2025 Pablo de Oliveira Salvato</p>
        </div>
    </footer>

    <!-- Debug panel (hidden) -->
    <button id="ai-debug-toggle" class="fixed bottom-4 right-4 z-40 h-9 w-9 rounded-full bg-crust-900/20 text-crust-400 opacity-20 hover:opacity-90 transition-opacity text-xs" aria-label="Logs IA" title="Logs de IA">ü™®</button>
    <aside id="ai-debug-panel" class="hidden fixed bottom-16 right-4 z-40 w-[min(92vw,460px)] bg-white border border-crust-200 rounded-xl shadow-2xl">
        <div class="flex items-center justify-between px-4 py-3 border-b bg-crust-50 rounded-t-xl">
            <h3 class="font-semibold text-xs text-crust-700">Logs da IA</h3>
            <div class="flex items-center gap-2">
                <button id="ai-debug-clear" class="text-xs px-2 py-1 rounded bg-crust-200 hover:bg-crust-300 text-crust-700">Limpar</button>
                <button id="ai-debug-close" class="text-xs px-2 py-1 rounded bg-crust-200 hover:bg-crust-300 text-crust-700">Fechar</button>
            </div>
        </div>
        <pre id="ai-debug-output" class="h-52 overflow-y-auto p-4 text-xs text-crust-700 whitespace-pre-wrap">Sem logs.</pre>
    </aside>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
    /* ‚îÄ‚îÄ Tab system ‚îÄ‚îÄ */
    const TABS = ['general','academic','petrografia','kids','infografico','galeria'];

    function switchTab(id) {
        TABS.forEach(t => {
            const view = document.getElementById(`view-${t}`);
            const btn  = document.getElementById(`tab-${t}`);
            if (t === id) {
                view.classList.remove('hidden');
                requestAnimationFrame(() => view.classList.add('visible'));
                btn.classList.add('active');
            } else {
                view.classList.add('hidden');
                view.classList.remove('visible');
                btn.classList.remove('active');
            }
        });
        if (id === 'academic') { mineralChart?.resize(); ptPathChart?.resize(); }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ‚îÄ‚îÄ Chat ‚îÄ‚îÄ */
    function handleEnter(e, mode) { if (e.key === 'Enter') askGemini(mode); }

    const TCC_CONTEXT = `Contexto do TCC: Pablo de Oliveira Salvato (UFES), tema "Caracteriza√ß√£o Petrogr√°fica e Evolu√ß√£o Textural da Granada em paragnaisse migmatizado da Bacutia (Guarapari-ES)".
Pontos-chave: pico metam√≥rfico ~800 ¬∞C e ~7,5 kbar; trajet√≥ria pr√≥grada com fus√£o parcial; rea√ß√£o simplificada Bt + Qtz + Pl -> Grt + Kfs + melt; fase retr√≥grada com cristaliza√ß√£o do melt; duas gera√ß√µes de granada (Grt1 poiquilobl√°stica com inclus√µes e Grt2 limpa no leucossoma); tr√™s gera√ß√µes de biotita; cordierita pinitizada.
Ao responder, mantenha o foco nesse TCC e, se algo n√£o estiver no contexto, diga que √© uma infer√™ncia.`;

    const SYSTEM_PROMPTS = {
        academic: `Voc√™ √© um assistente t√©cnico do TCC do Pablo Salvato. Responda com linguagem formal e objetiva para d√∫vidas acad√™micas. ${TCC_CONTEXT}`,
        kids: `Aja como a "Dona Granada". Uma rocha mineral vermelha, muito dura e brilhante, de 600 milh√µes de anos, moradora da Praia da Bacutia. Av√≥ rabugenta (odeia frio), carinhosa, orgulhosa de ser "nascida no fogo". Use emojis (üåãüíéüî•üëµ). Chame o usu√°rio de "meu pedregulho" ou "pequeno ge√≥logo". Explique para crian√ßas de 8 anos. M√°ximo 3 frases curtas. ${TCC_CONTEXT}`
    };

    const INFOGRAFICO_IMAGES = [
        { src:'assets/infografico-bacutia_opt.jpg', alt:'Infogr√°fico sobre anatexia na Bacutia', title:'Infogr√°fico ‚Äî Anatexia na Bacutia', description:'Diagrama mostrando a evolu√ß√£o metam√≥rfica dos paragnaisses da Praia da Bacutia.' }
    ];

    const AI_DEBUG_LOG_LIMIT = 40;
    const aiDebugLogs = [];

    function addAiDebugLog(entry) {
        aiDebugLogs.push({ timestamp: new Date().toISOString(), ...entry });
        if (aiDebugLogs.length > AI_DEBUG_LOG_LIMIT) aiDebugLogs.shift();
        const el = document.getElementById('ai-debug-output');
        if (el) { el.textContent = aiDebugLogs.map(i => JSON.stringify(i,null,2)).join('\n\n'); el.scrollTop = el.scrollHeight; }
    }

    function setupAiDebugPanel() {
        const toggle = document.getElementById('ai-debug-toggle');
        const panel  = document.getElementById('ai-debug-panel');
        const close  = document.getElementById('ai-debug-close');
        const clear  = document.getElementById('ai-debug-clear');
        if (!toggle||!panel) return;
        toggle.addEventListener('click', () => panel.classList.toggle('hidden'));
        close?.addEventListener('click', () => panel.classList.add('hidden'));
        clear?.addEventListener('click', () => { aiDebugLogs.length=0; const o=document.getElementById('ai-debug-output'); if(o) o.textContent='Sem logs.'; });
    }

    function renderInfografico() {
        const el = document.getElementById('infografico-gallery');
        if (!el) return;
        el.innerHTML = '';
        INFOGRAFICO_IMAGES.forEach(img => {
            const card = document.createElement('article');
            card.className = 'bg-crust-50 border border-crust-100 rounded-xl p-4';
            const title = document.createElement('h3');
            title.className = 'font-heading text-xl font-bold text-crust-800 mb-3';
            title.textContent = img.title;
            const image = document.createElement('img');
            image.src = img.src; image.alt = img.alt; image.loading = 'lazy';
            image.className = 'w-full h-auto rounded-xl border border-crust-200 shadow-sm';
            const fallback = document.createElement('p');
            fallback.className = 'hidden mt-3 bg-garnet-50 border border-garnet-100 rounded-lg p-3 text-sm text-garnet-700';
            fallback.textContent = `N√£o foi poss√≠vel carregar "${img.title}". Verifique ${img.src}.`;
            image.addEventListener('error', () => { image.classList.add('hidden'); fallback.classList.remove('hidden'); });
            const desc = document.createElement('p');
            desc.className = 'text-xs text-crust-400 mt-3 text-center'; desc.textContent = img.description;
            card.append(title, image, fallback, desc);
            el.appendChild(card);
        });
    }

    function buildKidsInstruction(text) { return `${text}\n\nResponda de forma curtinha, no m√°ximo 3 frases.`; }

    function buildChatEndpoints() {
        const custom = window.CHAT_API_BASE_URL ? String(window.CHAT_API_BASE_URL).trim().replace(/\/$/,'') : '';
        const candidates = custom ? [`${custom}/api/chat`,`${custom}/chat`,'/api/chat','/chat'] : ['/api/chat','/chat'];
        return [...new Set(candidates)];
    }

    async function postChatWithFallback(payload) {
        const endpoints = buildChatEndpoints();
        let lastError = null;
        for (const ep of endpoints) {
            let response;
            try { response = await fetch(ep, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) }); } catch(e) {
                addAiDebugLog({ type:'network-error', endpoint:ep, mode:payload.mode, message:e?.message });
                lastError = new Error('Erro de rede. Verifique se o backend est√° online.'); continue;
            }
            const data = await response.json().catch(()=>null);
            addAiDebugLog({ type:response.ok?'ok':'fail', endpoint:ep, status:response.status, hasAnswer:Boolean(data?.answer) });
            if (response.ok) return { response, data, endpoint:ep };
            lastError = new Error(data?.error || `Status ${response.status}`);
            if (response.status===404||response.status===405) continue;
            throw lastError;
        }
        throw lastError || new Error('Endpoint de chat inacess√≠vel.');
    }

    setupAiDebugPanel();
    renderInfografico();

    async function askGemini(mode) {
        const inputEl  = document.getElementById(`${mode}-chat-input`);
        const outputEl = document.getElementById(`${mode}-chat-output`);
        const text = inputEl.value.trim();
        if (!text) return;

        const userMsg = document.createElement('div');
        userMsg.className = `chat-bubble p-3 chat-user ${mode==='kids'?'font-comic':''}`;
        userMsg.innerText = text;
        outputEl.appendChild(userMsg);
        inputEl.value = '';
        outputEl.scrollTop = outputEl.scrollHeight;

        const loading = document.createElement('div');
        loading.className = `chat-bubble p-3 ${mode==='kids'?'chat-kids font-comic':'chat-ai'} typing`;
        loading.innerText = '';
        outputEl.appendChild(loading);

        try {
            const { data } = await postChatWithFallback({ mode, text: mode==='kids'? buildKidsInstruction(text) : text });
            const answer = data?.answer?.trim();
            if (!answer) throw new Error('Resposta vazia.');
            loading.remove();
            const aiMsg = document.createElement('div');
            aiMsg.className = `chat-bubble p-3 ${mode==='kids'?'chat-kids font-comic':'chat-ai'}`;
            aiMsg.innerText = answer;
            outputEl.appendChild(aiMsg);
        } catch(e) {
            loading.remove();
            const err = document.createElement('div');
            err.className = `chat-bubble p-3 ${mode==='kids'?'chat-kids font-comic':'chat-ai'}`;
            err.innerText = e.message || 'N√£o consegui responder agora.';
            outputEl.appendChild(err);
        }
        outputEl.scrollTop = outputEl.scrollHeight;
    }

    /* ‚îÄ‚îÄ Charts ‚îÄ‚îÄ */
    const mineralChart = new Chart(document.getElementById('mineralChart'), {
        type: 'bar',
        data: {
            labels: ['Prot√≥lito','Pico','Retro'],
            datasets: [
                { label:'Biotita', data:[40,5,15], backgroundColor:'#3C2D2B' },
                { label:'Granada', data:[0,25,20], backgroundColor:'#9B1B1B' },
                { label:'K-feldspato', data:[5,15,18], backgroundColor:'#A8947D' },
                { label:'Melt', data:[0,30,0], backgroundColor:'#FFD06B' },
            ]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom', labels:{ font:{size:11} } } }, scales:{ x:{stacked:true}, y:{stacked:true, title:{display:true,text:'Volume %'}} } }
    });

    const ptPathChart = new Chart(document.getElementById('ptPathChart'), {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Trajet√≥ria P-T',
                data: [{x:400,y:3},{x:600,y:5.5},{x:800,y:7.5},{x:700,y:4.5}],
                borderColor:'#9B1B1B', backgroundColor:'#9B1B1B', showLine:true, tension:0.3, pointRadius:6, pointHoverRadius:8
            }]
        },
        options: {
            responsive:true, maintainAspectRatio:false,
            plugins:{ legend:{ display:false } },
            scales:{
                x:{ title:{display:true,text:'Temperatura (¬∞C)'}, min:300, max:900 },
                y:{ title:{display:true,text:'Press√£o (kbar)'}, min:1, max:10 }
            }
        }
    });

    /* ‚îÄ‚îÄ Rock simulator ‚îÄ‚îÄ */
    function sliderToTemperature(v) { return Math.round(200+v*6); }
    function sliderToPressure(v) { return Number((1+v*0.09).toFixed(1)); }

    function setRockPreset(p) {
        const presets = { low:{t:20,p:22}, medium:{t:52,p:58}, peak:{t:100,p:72}, retro:{t:78,p:40} };
        const s = presets[p]; if(!s) return;
        document.getElementById('tempSlider').value = s.t;
        document.getElementById('pressSlider').value = s.p;
        updateRock();
    }

    function updateRock() {
        const Ts = parseInt(document.getElementById('tempSlider').value);
        const Ps = parseInt(document.getElementById('pressSlider').value);
        const T = sliderToTemperature(Ts);
        const P = sliderToPressure(Ps);
        document.getElementById('tempValue').innerText = T;
        document.getElementById('pressValue').innerText = P;

        const canvas = document.getElementById('rockCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0,0,250,250);

        const gi = Math.min(1,Math.max(0,(T-250)/600));
        const pi = Math.min(1,Math.max(0,(P-1)/8));

        let base = '#8D7460';
        if (T>=680&&P>=5.8) base = '#9B1B1B';
        else if (T>=520&&P>=3.8) base = '#6E574A';

        const g = ctx.createRadialGradient(90,80,30,125,125,120);
        g.addColorStop(0,'#FAF8F6'); g.addColorStop(0.45,base); g.addColorStop(1,'#261B1A');
        ctx.fillStyle = g; ctx.beginPath(); ctx.arc(125,125,100,0,Math.PI*2); ctx.fill();

        const fd = Math.floor(4+pi*12);
        ctx.strokeStyle = 'rgba(30,20,15,0.4)';
        ctx.lineWidth = 1+pi*3;
        for (let i=0; i<fd; i++) {
            const y = 60+i*(130/fd);
            const o = Math.sin(i*0.8+gi*3)*10;
            ctx.beginPath(); ctx.moveTo(40,y+o); ctx.quadraticCurveTo(125,y-o*0.5,210,y+o); ctx.stroke();
        }

        const mf = Math.max(0,Math.min(1,((T-680)/160+(P-5.5)/4)/2));
        const mp = Math.round(mf*100);

        if (mf>0.04) {
            const v = Math.max(1,Math.floor(mf*10));
            ctx.fillStyle = 'rgba(255,230,150,0.85)';
            for (let i=0;i<v;i++) {
                const x=60+((i*31)%130), y=75+((i*47)%105), r=4+mf*10;
                ctx.beginPath(); ctx.ellipse(x,y,r,r*0.5,i,0,Math.PI*2); ctx.fill();
            }
        }

        document.getElementById('meltBar').style.width = `${mp}%`;
        document.getElementById('meltText').innerText = `${mp}% de melt`;

        let title='Sedimento marinho compactado', desc='Baixo grau metam√≥rfico: minerais finos e pouca reorganiza√ß√£o.';
        if (T>=460&&P>=3.2) { title='Paragnaisse em metamorfismo progressivo'; desc='Biotita + quartzo + plagiocl√°sio se reorganizam com folia√ß√£o mais marcada.'; }
        if (T>=620&&P>=5.2) { title='Zona de rea√ß√£o ‚Äî forma√ß√£o de granada'; desc='Bt + Qtz + Pl ‚Üí Grt + Kfs + melt. Aparecem por√ß√µes leucocr√°ticas.'; }
        if (T>=760&&P>=6.8) { title='Pico metam√≥rfico da Bacutia (migmatito)'; desc='~800 ¬∞C / 7,5 kbar: anatexia parcial intensa e crescimento de granada Grt‚ÇÅ.'; }
        if (T>=700&&P<5.4) { title='Retrograda√ß√£o em descompress√£o'; desc='Melt cristaliza, Grt‚ÇÇ surge no leucossoma. Cordierita pinitizada marca a descompress√£o.'; }

        document.getElementById('rock-status-title').innerText = title;
        document.getElementById('rock-status-desc').innerText = desc;
    }
    updateRock();
    </script>
</body>
</html>
