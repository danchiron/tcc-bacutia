<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Vida Secreta das Rochas - TCC Pablo Salvato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #EFEBE9; color: #3E2723; }
        h1, h2, h3, h4 { font-family: 'Merriweather', serif; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 350px;
            max-height: 400px;
        }

        .chat-message {
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }
        .user-msg {
            background-color: #D7CCC8;
            align-self: flex-end;
            margin-left: auto;
            text-align: left;
        }
        .ai-msg {
            background-color: #FFCCBC;
            align-self: flex-start;
            border-left: 4px solid #B71C1C;
        }
        .font-comic { font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif; }

        .active-tab {
            background-color: #5D4037;
            color: white;
            border-bottom: 4px solid #B71C1C;
        }
        .inactive-tab {
            background-color: white;
            color: #5D4037;
            border-bottom: 4px solid transparent;
        }

        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .typing-indicator::after {
            content: '...';
            animation: ellipsis 1.5s infinite;
        }
        @keyframes ellipsis {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-[#5D4037] text-white py-8 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-2 text-[#FFCCBC]">O Segredo das Pedras da Bacutia</h1>
            <p class="text-lg md:text-xl font-light text-gray-200 uppercase tracking-widest">Caracterização Petrográfica e Evolução Textural da Granada</p>
            <p class="text-sm mt-4 opacity-80 italic">Uma jornada pelas profundezas de Guarapari-ES</p>
            <div class="mt-4 flex flex-col md:flex-row justify-center items-center gap-2 md:gap-8 opacity-90">
                <p>Autor: <span class="font-bold">Pablo de Oliveira Salvato</span></p>
                <p>Orientação: <span class="font-bold">Prof.ª Dr.ª Marilane Gonzaga de Melo</span></p>
            </div>
        </div>
    </header>

    <nav class="sticky top-0 z-50 bg-[#EFEBE9] shadow-md border-b border-gray-300">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center space-x-1 py-3">
                <button onclick="switchTab('general')" id="tab-general" class="px-4 md:px-8 py-3 rounded-t-lg font-bold transition-all active-tab shadow-sm">
                    Geral
                </button>
                <button onclick="switchTab('academic')" id="tab-academic" class="px-4 md:px-8 py-3 rounded-t-lg font-bold transition-all inactive-tab shadow-sm">
                    Acadêmico
                </button>
                <button onclick="switchTab('kids')" id="tab-kids" class="px-4 md:px-8 py-3 rounded-t-lg font-bold transition-all inactive-tab shadow-sm">
                    Interativo
                </button>
                <button onclick="switchTab('infografico')" id="tab-infografico" class="px-4 md:px-8 py-3 rounded-t-lg font-bold transition-all inactive-tab shadow-sm">
                    Infográfico
                </button>
            </div>
        </div>
    </nav>

    <main id="content-area" class="flex-grow container mx-auto px-4 py-8">
        
        <section id="view-general" class="fade-in space-y-12">
            <div class="max-w-4xl mx-auto text-center bg-white p-8 rounded-xl shadow-md border-t-4 border-[#8D6E63]">
                <h2 class="text-3xl font-bold text-[#5D4037] mb-4">A Ciência por trás da Beleza</h2>
                <p class="text-lg text-gray-700 leading-relaxed">
                    A Praia da Bacutia não é só cenário de férias: é uma cicatriz geológica da colisão entre continentes que ajudou a erguer, no passado, uma cadeia de montanhas colossal no leste do Brasil.
                </p>
                <p class="text-base text-gray-700 leading-relaxed mt-4 text-left">
                    Cada passo sobre essas pedras é uma viagem no tempo. Você está pisando nas raízes profundas de uma antiga montanha — um verdadeiro “Himalaia brasileiro” — forjada por pressões gigantescas, calor extremo e rios de rocha parcialmente derretida.
                </p>
                <p class="text-base text-gray-700 leading-relaxed mt-4 text-left">
                    Aqui, a Terra conta uma história de fogo e renascimento: sedimentos viraram rocha, a rocha quase virou magma, cristais nasceram no coração da crosta e, milhões de anos depois, tudo voltou à superfície para ser revelado entre o mar, o sol e a areia de Guarapari.
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-4 rounded-xl shadow-xl border border-gray-200">
                    <h3 class="text-xl font-bold text-[#5D4037] mb-3">Vídeo da apresentação</h3>
                    <div class="relative w-full overflow-hidden rounded-lg" style="padding-top: 56.25%;">
                        <iframe
                            class="absolute top-0 left-0 w-full h-full"
                            src="https://drive.google.com/file/d/1EQX99wclcQy_10unqbkrfTINQu24w8AN/preview"
                            title="Apresentação do TCC - Pablo Salvato"
                            allow="autoplay"
                            loading="lazy">
                        </iframe>
                    </div>
                    <p class="text-sm text-gray-600 mt-3">Se o vídeo não carregar automaticamente, abra o link no Google Drive.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-bold text-[#5D4037] mb-4">Como as rochas mudaram?</h3>
                    <div class="space-y-4">
                        <div class="flex gap-4">
                            <div class="bg-[#B71C1C] text-white w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">1</div>
                            <p class="text-gray-700"><strong>Lama:</strong> Tudo começou como lama no oceano antigo.</p>
                        </div>
                        <div class="flex gap-4">
                            <div class="bg-[#B71C1C] text-white w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">2</div>
                            <p class="text-gray-700"><strong>Calor:</strong> A rocha foi "cozinhada" a 800°C nas profundezas.</p>
                        </div>
                        <div class="flex gap-4">
                            <div class="bg-[#B71C1C] text-white w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">3</div>
                            <p class="text-gray-700"><strong>Cristal:</strong> Nasceram as Granadas, as "joias" da rocha.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-academic" class="hidden fade-in space-y-12">
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-8 border-[#B71C1C]">
                        <h3 class="text-2xl font-bold text-[#5D4037] mb-4">Resumo Acadêmico</h3>
                        <p class="text-gray-700 text-justify">
                            Paragnaisses migmatizados da Praia da Bacutia revelam fusão por desidratação da biotita
                            (<strong>Bt + Qtz + Pl → Grt<sub>1</sub> + Kfs + Melt</strong>).
                            O pico metamórfico foi atingido em ~800–850 °C e ~7,5 kbar, em condições de fácies granulito.
                        </p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-8 border-[#8D6E63] space-y-3">
                        <h3 class="text-2xl font-bold text-[#5D4037]">Narrativa Petrogenética (texto-base do TCC)</h3>
                        <p class="text-gray-700 text-justify">
                            O protólito pelítico dos paragnaisses da Bacutia foi progressivamente soterrado durante a
                            convergência neoproterozoica associada ao Orógeno Araçuaí. O aumento acoplado de temperatura
                            e pressão levou à desestabilização da biotita, promovendo fusão parcial por desidratação e
                            geração de melt silicático, K-feldspato e granada. Nesse estágio, a granada <strong>Grt<sub>1</sub></strong>
                            tende a registrar inclusões minerais e microestruturas herdadas da matriz, compatíveis com
                            crescimento prógrado em ambiente de alto grau.
                        </p>
                        <p class="text-gray-700 text-justify">
                            A condição de pico, em ~800–850 °C e ~7,5 kbar, indica metamorfismo em fácies granulito em
                            profundidades crustais intermediárias (~25 km). Após o ápice térmico, o sistema evoluiu para
                            exumação e resfriamento, com cristalização progressiva do melt remanescente e reequilíbrios
                            texturais. Nesse contexto, a granada <strong>Grt<sub>2</sub></strong> pode ocorrer mais limpa, com menor carga
                            de inclusões, refletindo estágios tardios de crescimento e/ou recristalização.
                        </p>
                        <p class="text-gray-700 text-justify">
                            Na trajetória retrógrada, a formação de coroas e bordas de <strong>cordierita</strong> ao redor da granada
                            expressa descompressão e hidratação relativa do sistema. Assim, a associação Grt–Bt–Sil com
                            Cord retrograda preserva um registro integrado de aquecimento colisional, anatexia e evolução
                            pós-pico, oferecendo uma base robusta para reconstruções P–T–t da história metamórfica da
                            região de Guarapari-ES.
                        </p>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-md h-[400px]">
                            <canvas id="mineralChart"></canvas>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md h-[400px]">
                            <canvas id="ptPathChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="bg-[#EFEBE9] p-4 rounded-xl shadow-lg border-2 border-[#8D6E63] flex flex-col h-[600px]">
                    <h4 class="text-lg font-bold text-[#5D4037] mb-4">Chat de Pesquisa IA</h4>
                    <div id="academic-chat-output" class="flex-grow overflow-y-auto bg-white p-3 rounded-lg border flex flex-col gap-3 text-sm mb-4">
                        <div class="ai-msg chat-message">Dúvidas técnicas sobre o TCC? Pergunte aqui.</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="academic-chat-input" placeholder="Ex: O que é Grt1?" class="flex-grow p-2 rounded border focus:outline-none" onkeypress="handleEnter(event, 'academic')">
                        <button onclick="askGemini('academic')" class="bg-[#5D4037] text-white px-4 rounded-lg">➤</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-kids" class="hidden fade-in space-y-12">
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-xl border-4 border-[#8D6E63]">
                    <h2 class="text-2xl font-bold text-center mb-6">Laboratório de Rochas</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <label class="block font-bold">Temperatura</label>
                            <input type="range" id="tempSlider" min="1" max="100" value="10" class="w-full accent-red-600" oninput="updateRock()">
                            <p class="text-sm text-gray-700">Escala aproximada: <span id="tempValue" class="font-bold">260</span> °C</p>
                            <label class="block font-bold">Pressão</label>
                            <input type="range" id="pressSlider" min="1" max="100" value="10" class="w-full accent-stone-700" oninput="updateRock()">
                            <p class="text-sm text-gray-700">Escala aproximada: <span id="pressValue" class="font-bold">1.7</span> kbar</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setRockPreset('low')" class="bg-stone-200 hover:bg-stone-300 px-2 py-2 rounded text-sm">Baixo grau</button>
                                <button onclick="setRockPreset('medium')" class="bg-amber-200 hover:bg-amber-300 px-2 py-2 rounded text-sm">Médio grau</button>
                                <button onclick="setRockPreset('peak')" class="bg-red-200 hover:bg-red-300 px-2 py-2 rounded text-sm">Pico Bacutia</button>
                                <button onclick="setRockPreset('retro')" class="bg-blue-200 hover:bg-blue-300 px-2 py-2 rounded text-sm">Retrogradação</button>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
                                <h4 class="font-bold" id="rock-status-title">Lama do Mar</h4>
                                <p class="text-sm" id="rock-status-desc">Arraste os controles!</p>
                                <div class="mt-3">
                                    <p class="text-xs uppercase tracking-wide text-gray-600">Fração de fusão parcial</p>
                                    <div class="w-full bg-blue-100 rounded-full h-3 mt-1 overflow-hidden">
                                        <div id="meltBar" class="h-3 bg-gradient-to-r from-amber-300 to-red-500 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <p class="text-xs mt-1 text-gray-700" id="meltText">0% de melt</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-600 leading-relaxed">
                                Modelo educativo inspirado em trajetórias P-T de metamorfismo regional (baixo grau → anfibolito → migmatito) e na condição de pico reportada no TCC (~800 °C / 7,5 kbar).
                            </p>
                        </div>
                        <div class="flex items-center justify-center">
                            <canvas id="rockCanvas" width="250" height="250" class="rounded-full bg-gray-50 shadow-inner"></canvas>
                        </div>
                    </div>
                </div>
                <div class="bg-[#FFF3E0] p-4 rounded-2xl shadow-xl border-4 border-[#FFAB91] flex flex-col h-[600px]">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-[#B71C1C] rounded-full mx-auto flex items-center justify-center text-3xl text-white">DG</div>
                        <h4 class="font-bold text-[#BF360C] mt-2">Dona Granada</h4>
                    </div>
                    <div id="kids-chat-output" class="flex-grow overflow-y-auto bg-white p-3 rounded-xl flex flex-col gap-3 mb-4 font-comic text-sm">
                        <div class="ai-msg chat-message">Olá! Sou a Dona Granada. Nasci no calor da terra! Pergunte qualquer coisa!</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="kids-chat-input" placeholder="Diz olá!" class="flex-grow p-3 rounded-full border-2 border-[#FFAB91] focus:outline-none font-comic" onkeypress="handleEnter(event, 'kids')">
                        <button onclick="askGemini('kids')" class="bg-[#BF360C] text-white w-12 h-12 rounded-full font-bold shadow-lg">OK</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-infografico" class="hidden fade-in space-y-8">
            <div class="max-w-5xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-xl border border-gray-200">
                <h2 class="text-3xl font-bold text-[#5D4037] text-center mb-2">Infográfico</h2>
                <p class="text-center text-gray-700 mb-6">Anatexia em destaque</p>
                <img
                    src="https://drive.google.com/uc?export=view&id=1OyOmMzWaXJBx5g-ROvl-s_4RcZiNY8Sh"
                    alt="Infográfico sobre anatexia"
                    class="w-full h-auto rounded-xl border border-gray-300 shadow-sm"
                    loading="lazy"
                >
                <p class="text-xs text-gray-500 mt-3 text-center">
                    Imagem em alta resolução carregada por link direto do Google Drive para evitar incompatibilidade com arquivos binários no repositório.
                </p>
            </div>
        </section>
    </main>

    <footer class="bg-[#3E2723] text-[#D7CCC8] py-8 text-center border-t-4 border-[#B71C1C]">
        <p class="font-bold">UFES - Departamento de Geologia</p>
        <p class="text-xs opacity-50 mt-2">&copy; 2025 Pablo Salvato & Gemini AI</p>
    </footer>

    <script>
        const apiKey = "AIzaSyDcHaFb2wVSyxpodcoy6lr1_hW5TKAVQDI";

        function switchTab(tabId) {
            ['general', 'academic', 'kids', 'infografico'].forEach(id => {
                document.getElementById(`view-${id}`).classList.add('hidden');
                document.getElementById(`tab-${id}`).classList.replace('active-tab', 'inactive-tab');
            });
            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            document.getElementById(`tab-${tabId}`).classList.replace('inactive-tab', 'active-tab');
            if (tabId === 'academic') { mineralChart.resize(); ptPathChart.resize(); }
        }

        function handleEnter(e, mode) { if (e.key === 'Enter') askGemini(mode); }

        const TCC_CONTEXT = `
            Contexto do TCC: Pablo de Oliveira Salvato (UFES), tema "Caracterização Petrográfica e Evolução Textural da Granada em paragnaisse migmatizado da Bacutia (Guarapari-ES)".
            Pontos-chave: pico metamórfico ~800 °C e ~7,5 kbar; trajetória prógrada com fusão parcial; reação simplificada Bt + Qtz + Pl -> Grt + Kfs + melt; fase retrógrada com cristalização do melt.
            Ao responder, mantenha o foco nesse TCC e, se algo não estiver no contexto, diga que é uma inferência.
        `;

        const SYSTEM_PROMPTS = {
            academic: `Você é um assistente técnico do TCC do Pablo Salvato. Responda com linguagem formal e objetiva para dúvidas acadêmicas. ${TCC_CONTEXT}`,
            kids: `Você é a Dona Granada, personagem educativa do TCC do Pablo Salvato. Fale de forma divertida com emojis, com explicações simples para crianças, sem perder o foco no TCC. ${TCC_CONTEXT}`
        };

        async function askGemini(mode) {
            const inputId = `${mode}-chat-input`;
            const outputId = `${mode}-chat-output`;
            const inputEl = document.getElementById(inputId);
            const outputEl = document.getElementById(outputId);
            const text = inputEl.value.trim();
            if (!text) return;

            const userMsg = document.createElement('div');
            userMsg.className = `user-msg chat-message ${mode === 'kids' ? 'font-comic' : ''}`;
            userMsg.innerText = text;
            outputEl.appendChild(userMsg);
            inputEl.value = '';
            outputEl.scrollTop = outputEl.scrollHeight;

            const loading = document.createElement('div');
            loading.className = `ai-msg chat-message typing-indicator ${mode === 'kids' ? 'font-comic' : ''}`;
            loading.innerText = "...";
            outputEl.appendChild(loading);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        system_instruction: { parts: [{ text: SYSTEM_PROMPTS[mode] }] },
                        contents: [{ role: 'user', parts: [{ text }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Gemini retornou status ${response.status}`);
                }

                const data = await response.json();
                const answer = data?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!answer) {
                    throw new Error('Resposta vazia da API Gemini.');
                }

                outputEl.removeChild(loading);
                const aiMsg = document.createElement('div');
                aiMsg.className = `ai-msg chat-message ${mode === 'kids' ? 'font-comic' : ''}`;
                aiMsg.innerText = answer;
                outputEl.appendChild(aiMsg);
                outputEl.scrollTop = outputEl.scrollHeight;
            } catch (e) {
                loading.innerText = "Não consegui responder agora. Tente novamente em instantes.";
            }
        }

        const mineralChart = new Chart(document.getElementById('mineralChart'), {
            type: 'bar',
            data: {
                labels: ['Protólito', 'Pico', 'Retro'],
                datasets: [
                    { label: 'Biotita', data: [40, 5, 15], backgroundColor: '#3E2723' },
                    { label: 'Granada', data: [0, 25, 20], backgroundColor: '#B71C1C' },
                    { label: 'Melt', data: [0, 30, 0], backgroundColor: '#FFCCBC' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        const ptPathChart = new Chart(document.getElementById('ptPathChart'), {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Caminho P-T',
                    data: [{x: 400, y: 3}, {x: 800, y: 7.5}, {x: 700, y: 4.5}],
                    borderColor: '#B71C1C', backgroundColor: '#B71C1C', showLine: true
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        function sliderToTemperature(sliderValue) {
            return Math.round(200 + sliderValue * 6);
        }

        function sliderToPressure(sliderValue) {
            return Number((1 + sliderValue * 0.09).toFixed(1));
        }

        function setRockPreset(preset) {
            const presets = {
                low: { t: 20, p: 22 },
                medium: { t: 52, p: 58 },
                peak: { t: 100, p: 72 },
                retro: { t: 78, p: 40 }
            };
            const selected = presets[preset];
            if (!selected) return;
            document.getElementById('tempSlider').value = selected.t;
            document.getElementById('pressSlider').value = selected.p;
            updateRock();
        }

        function updateRock() {
            const Tslider = parseInt(document.getElementById('tempSlider').value);
            const Pslider = parseInt(document.getElementById('pressSlider').value);
            const temperature = sliderToTemperature(Tslider);
            const pressure = sliderToPressure(Pslider);

            document.getElementById('tempValue').innerText = temperature;
            document.getElementById('pressValue').innerText = pressure;

            const canvas = document.getElementById('rockCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 250, 250);

            const geothermalIntensity = Math.min(1, Math.max(0, (temperature - 250) / 600));
            const pressureIntensity = Math.min(1, Math.max(0, (pressure - 1) / 8));

            let baseColor = '#8D6E63';
            if (temperature >= 680 && pressure >= 5.8) {
                baseColor = '#B71C1C';
            } else if (temperature >= 520 && pressure >= 3.8) {
                baseColor = '#6D4C41';
            }

            const gradient = ctx.createRadialGradient(90, 80, 30, 125, 125, 120);
            gradient.addColorStop(0, '#FBE9E7');
            gradient.addColorStop(0.45, baseColor);
            gradient.addColorStop(1, '#3E2723');

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(125, 125, 100, 0, Math.PI * 2);
            ctx.fill();

            const foliationDensity = Math.floor(4 + pressureIntensity * 12);
            ctx.strokeStyle = 'rgba(30, 20, 15, 0.45)';
            ctx.lineWidth = 1 + pressureIntensity * 3;
            for (let i = 0; i < foliationDensity; i++) {
                const y = 60 + i * (130 / foliationDensity);
                const offset = Math.sin(i * 0.8 + geothermalIntensity * 3) * 10;
                ctx.beginPath();
                ctx.moveTo(40, y + offset);
                ctx.quadraticCurveTo(125, y - offset * 0.5, 210, y + offset);
                ctx.stroke();
            }

            const meltFraction = Math.max(0, Math.min(1, ((temperature - 680) / 160 + (pressure - 5.5) / 4) / 2));
            const meltPercent = Math.round(meltFraction * 100);

            if (meltFraction > 0.04) {
                const veins = Math.max(1, Math.floor(meltFraction * 10));
                ctx.fillStyle = 'rgba(255, 230, 150, 0.85)';
                for (let i = 0; i < veins; i++) {
                    const x = 60 + ((i * 31) % 130);
                    const y = 75 + ((i * 47) % 105);
                    const r = 4 + meltFraction * 10;
                    ctx.beginPath();
                    ctx.ellipse(x, y, r, r * 0.5, i, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            document.getElementById('meltBar').style.width = `${meltPercent}%`;
            document.getElementById('meltText').innerText = `${meltPercent}% de melt`;

            let title = 'Sedimento marinho compactado';
            let desc = 'Baixo grau metamórfico: minerais finos e pouca reorganização.';

            if (temperature >= 460 && pressure >= 3.2) {
                title = 'Paragnaisse em metamorfismo progressivo';
                desc = 'Biotita + quartzo + plagioclásio se reorganizam com foliação mais marcada.';
            }

            if (temperature >= 620 && pressure >= 5.2) {
                title = 'Zona da reação de formação de granada';
                desc = 'Reação aproximada: Bt + Qtz + Pl → Grt + Kfs + melt. Aparecem porções leucocráticas.';
            }

            if (temperature >= 760 && pressure >= 6.8) {
                title = 'Pico metamórfico da Bacutia (migmatito)';
                desc = 'Condição de pico próxima de 800 °C / 7,5 kbar: anatexia parcial e crescimento de granada.';
            }

            if (temperature >= 700 && pressure < 5.4) {
                title = 'Retrogradação em descompressão';
                desc = 'Durante o resfriamento e queda de pressão, o melt cristaliza e novas texturas de equilíbrio surgem.';
            }

            document.getElementById('rock-status-title').innerText = title;
            document.getElementById('rock-status-desc').innerText = desc;
        }
        updateRock();
    </script>
</body>
</html>
