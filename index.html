<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade: A Vida Secreta das Rochas - TCC Pablo Salvato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #EFEBE9; color: #3E2723; scroll-behavior: smooth; }
        h1, h2, h3, h4 { font-family: 'Merriweather', serif; }
        
        /* Estilos da Lupa Virtual */
        .slider-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            overflow: hidden;
            margin: 20px auto;
            border: 4px solid #5D4037;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .img-fundo {
            background-image: url('https://placehold.co/600x400/5D4037/FFCCBC?text=FOTO+DO+AFLORAMENTO+PS02'); /* Substituir pela foto real */
            background-size: cover; background-position: center;
            width: 100%; height: 100%; position: absolute;
        }
        .img-frente {
            background-image: url('https://placehold.co/600x400/B71C1C/FFFFFF?text=FOTOMICROGRAFIA+Grt1'); /* Substituir pela foto da l√¢mina */
            background-size: cover; background-position: center;
            width: 50%; height: 100%; position: absolute;
            border-right: 4px solid white; z-index: 2;
        }
        .slider-control {
            position: absolute; width: 100%; height: 100%;
            opacity: 0; cursor: ew-resize; z-index: 10; margin: 0;
        }

        /* Gr√°ficos e Chat */
        .chart-container { position: relative; width: 100%; height: 300px; }
        .chat-message { padding: 10px; border-radius: 10px; margin-bottom: 8px; max-width: 85%; animation: fadeIn 0.3s ease; }
        .user-msg { background-color: #D7CCC8; align-self: flex-end; margin-left: auto; }
        .ai-msg { background-color: #FFCCBC; align-self: flex-start; border-left: 4px solid #B71C1C; }
        .active-tab { background-color: #5D4037; color: white; border-bottom: 4px solid #B71C1C; }
        .inactive-tab { background-color: white; color: #5D4037; }
        .typing-indicator::after { content: '...'; animation: ellipsis 1.5s infinite; }
        @keyframes ellipsis { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-[#5D4037] text-white py-12 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-2 text-[#FFCCBC]">
                <i class="fa-solid fa-hammer-metaphor mr-3"></i>O Segredo da Bacutia
            </h1>
            <p class="text-lg md:text-xl font-light text-gray-200 uppercase tracking-widest">Upgrade: Ci√™ncia e Interatividade</p>
            <div class="mt-6 flex flex-col md:flex-row justify-center items-center gap-4 opacity-90">
                <p><i class="fa-solid fa-user-graduate mr-2"></i>Pablo Salvato</p>
                <p><i class="fa-solid fa-chalkboard-user mr-2"></i>Prof.¬™ Dr.¬™ Marilane Melo</p>
            </div>
        </div>
    </header>

    <nav class="sticky top-0 z-50 bg-[#EFEBE9] shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center space-x-1 py-3">
                <button onclick="switchTab('general')" id="tab-general" class="px-6 py-3 rounded-t-lg font-bold active-tab"><i class="fa-solid fa-earth-americas mr-2"></i>Geral</button>
                <button onclick="switchTab('academic')" id="tab-academic" class="px-6 py-3 rounded-t-lg font-bold inactive-tab"><i class="fa-solid fa-microscope mr-2"></i>Acad√™mico</button>
                <button onclick="switchTab('kids')" id="tab-kids" class="px-6 py-3 rounded-t-lg font-bold inactive-tab"><i class="fa-solid fa-flask-vial mr-2"></i>Laborat√≥rio</button>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8">
        
        <section id="view-general" class="fade-in space-y-12">
            <div class="max-w-4xl mx-auto text-center bg-white p-8 rounded-xl shadow-md border-t-4 border-[#8D6E63]">
                <h2 class="text-3xl font-bold text-[#5D4037] mb-4">Onde voc√™ est√° pisando?</h2>
                <p class="text-lg text-gray-700">A Praia da Bacutia √© a cicatriz da colis√£o que uniu a Am√©rica e a √Åfrica h√° 580 milh√µes de anos. Voc√™ est√° caminhando sobre a raiz de um Himalaia extinto.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-[#B71C1C]">
                    <h3 class="text-xl font-bold mb-4 text-[#5D4037]"><i class="fa-solid fa-map-location-dot mr-2"></i>Contexto Gondwana</h3>
                    <div class="h-64 bg-gray-200 rounded-lg flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 opacity-40 bg-cover bg-center" style="background-image: url('https://placehold.co/600x400/8D6E63/FFFFFF?text=Mapa+Gondwana');"></div>
                        <div class="z-10 p-4 text-center">
                            <p class="text-sm font-bold bg-white/80 p-2 rounded">Brasil e √Åfrica colados: Aqui nasceram as rochas do Pablo.</p>
                        </div>
                    </div>
                    <p class="mt-4 text-sm text-gray-600">A monazita das nossas areias vem da eros√£o destes gnaisses que o Pablo estudou.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-[#5D4037]">
                    <h3 class="text-xl font-bold mb-4 text-[#5D4037]"><i class="fa-solid fa-gem mr-2"></i>Saiba Mais</h3>
                    <ul class="space-y-4 text-blue-800 underline">
                        <li><a href="#" target="_blank">Modelo 3D: Cristal de Granada (Grt2)</a></li>
                        <li><a href="#" target="_blank">V√≠deo: Areias Monaz√≠ticas de Guarapari</a></li>
                        <li><a href="#" target="_blank">Geologia da Prov√≠ncia Mantiqueira</a></li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="view-academic" class="hidden fade-in space-y-12">
            <div class="bg-white p-8 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold text-[#5D4037] mb-6"><i class="fa-solid fa-magnifying-glass-plus mr-2"></i>Lupa Virtual: Do Campo ao Microsc√≥pio</h3>
                <p class="mb-6 text-gray-600">Arraste a barra para comparar a textura da rocha no ponto PS02 (Esquerda) com a fotomicrografia da Granada 1 (Direita).</p>
                
                <div class="slider-container">
                    <div class="img-fundo"></div>
                    <div class="img-frente" id="imgOverlay"></div>
                    <input type="range" min="0" max="100" value="50" class="slider-control" oninput="document.getElementById('imgOverlay').style.width = this.value + '%'">
                </div>
                <p class="text-center text-xs text-gray-500 mt-2 italic">A Granada 1 (Poiquilobl√°stica) revela o passado da rocha atrav√©s de suas inclus√µes.</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-8 border-[#B71C1C]">
                        <h4 class="font-bold text-[#5D4037] mb-2">Pico Metam√≥rfico: 750-850¬∞C</h4>
                        <p class="text-sm text-gray-700">A anatexia (fus√£o) por desidrata√ß√£o da biotita √© o motor da cria√ß√£o das granadas perit√©ticas descritas no TCC.</p>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-md h-[300px]"><canvas id="mineralChart"></canvas></div>
                        <div class="bg-white p-4 rounded-xl shadow-md h-[300px]"><canvas id="ptPathChart"></canvas></div>
                    </div>
                </div>
                <div class="bg-[#EFEBE9] p-4 rounded-xl shadow-lg border-2 border-[#8D6E63] flex flex-col h-[500px]">
                    <h4 class="font-bold text-[#5D4037] mb-4 text-center">IA: Consultoria T√©cnica</h4>
                    <div id="academic-chat-output" class="flex-grow overflow-y-auto bg-white p-3 rounded-lg flex flex-col gap-3 text-xs mb-4"></div>
                    <div class="flex gap-2">
                        <input type="text" id="academic-chat-input" placeholder="D√∫vida t√©cnica..." class="flex-grow p-2 rounded text-xs border" onkeypress="handleEnter(event, 'academic')">
                        <button onclick="askGemini('academic')" class="bg-[#5D4037] text-white px-3 rounded">‚û§</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-kids" class="hidden fade-in space-y-12">
            <div class="bg-white p-8 rounded-2xl shadow-xl border-4 border-[#8D6E63]">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-[#5D4037]">F√°brica de Rochas Calibrada üåã</h2>
                    <p class="text-gray-600">Simule a temperatura real do TCC para ver a fus√£o da biotita acontecer!</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-8 bg-[#F5F5F5] p-6 rounded-xl">
                        <div>
                            <label class="block font-bold text-[#B71C1C] mb-2">üî• Temperatura: <span id="valTemp">20</span>¬∞C</label>
                            <input type="range" id="tempSlider" min="20" max="900" value="20" class="w-full accent-red-600" oninput="atualizarSimulacao()">
                        </div>
                        <div class="bg-white p-4 rounded-lg border-l-8 border-blue-500 shadow-sm min-h-[100px]">
                            <h4 class="font-bold text-lg text-[#5D4037]" id="rock-status-title">Sedimento Inicial</h4>
                            <p class="text-sm" id="rock-status-desc">Aperte o calor para enterrar a rocha.</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-center">
                        <canvas id="rockCanvas" width="280" height="280" class="rounded-full shadow-2xl border-8 border-gray-100 bg-gray-50"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="max-w-md mx-auto bg-[#FFF3E0] p-6 rounded-2xl shadow-xl border-4 border-[#FFAB91] h-[500px] flex flex-col">
                <h4 class="font-bold text-[#BF360C] text-center mb-4">Zap da Dona Granada ‚ú®</h4>
                <div id="kids-chat-output" class="flex-grow overflow-y-auto bg-white p-3 rounded-xl flex flex-col gap-3 mb-4 text-sm font-medium"></div>
                <div class="flex gap-2">
                    <input type="text" id="kids-chat-input" placeholder="Diz oi pra ela!" class="flex-grow p-3 rounded-full border-2 border-[#FFAB91]" onkeypress="handleEnter(event, 'kids')">
                    <button onclick="askGemini('kids')" class="bg-[#BF360C] text-white w-12 h-12 rounded-full font-bold">‚ú®</button>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-[#3E2723] text-[#D7CCC8] py-8 text-center border-t-4 border-[#B71C1C]">
        <p class="font-bold">Upgrade TCC - Pablo Salvato & IA</p>
        <p class="text-xs opacity-50 mt-2">Tecnologia Gemini 2.0 Flash</p>
    </footer>

    <script>
        const apiKey = "AIzaSyDcHaFb2wVSyxpodcoy6lr1_hW5TKAVQDI";

        function switchTab(tabId) {
            ['general', 'academic', 'kids'].forEach(id => {
                document.getElementById(`view-${id}`).classList.add('hidden');
                document.getElementById(`tab-${id}`).className = 'px-6 py-3 rounded-t-lg font-bold inactive-tab';
            });
            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            document.getElementById(`tab-${tabId}`).className = 'px-6 py-3 rounded-t-lg font-bold active-tab';
        }

        function handleEnter(e, m) { if(e.key==='Enter') askGemini(m); }

        // --- SIMULADOR CALIBRADO ---
        const canvas = document.getElementById('rockCanvas');
        const ctx = canvas.getContext('2d');
        function atualizarSimulacao() {
            const temp = parseInt(document.getElementById('tempSlider').value);
            document.getElementById('valTemp').innerText = temp;
            const title = document.getElementById('rock-status-title');
            const desc = document.getElementById('rock-status-desc');

            ctx.clearRect(0,0,280,280);
            
            // L√≥gica de Cores e Texturas
            if (temp < 200) {
                ctx.fillStyle = '#8B4513';
                title.innerText = "LAMA (Bacia de Retroarco)";
                desc.innerText = "Ainda √© sedimento no fundo do mar antigo.";
            } else if (temp < 750) {
                ctx.fillStyle = '#5D4037';
                title.innerText = "GNAISSE (Rocha S√≥lida)";
                desc.innerText = "A press√£o formou camadas, mas a rocha ainda √© s√≥lida (Paleossoma).";
                // Desenhar linhas de folia√ß√£o
                ctx.strokeStyle = '#3E2723'; ctx.lineWidth = 2;
                for(let i=0; i<10; i++) {
                    ctx.beginPath(); ctx.moveTo(40, 60+i*15); ctx.lineTo(240, 60+i*15); ctx.stroke();
                }
            } else {
                ctx.fillStyle = '#FF4500';
                title.innerHTML = "üî• MIGMATITO (ANATEXIA!)";
                desc.innerHTML = "Atingimos 750¬∞C. A biotita derreteu! Nasceram as Granadas Perit√©ticas (Grt2) l√≠mpidas.";
                // Desenhar magma e granadas perit√©ticas
                ctx.shadowBlur = 15; ctx.shadowColor = 'yellow';
                for(let i=0; i<8; i++) {
                    ctx.fillStyle = '#cc0000';
                    ctx.beginPath(); ctx.arc(60+Math.random()*160, 60+Math.random()*160, 15, 0, Math.PI*2); ctx.fill();
                }
                ctx.shadowBlur = 0;
            }
            ctx.beginPath(); ctx.arc(140, 140, 110, 0, Math.PI*2); ctx.fill();
        }

        // --- GEMINI AI ---
        const SYSTEM_PROMPTS = {
            academic: "Voc√™ √© um consultor t√©cnico do TCC do Pablo Salvato. Foque em anatexia, granadas Grt1/Grt2 e Pico em 800C. Seja t√©cnico.",
            kids: "Voc√™ √© a Dona Granada, uma pedra de 600 milh√µes de anos. Fale de forma divertida e use emojis."
        };

        async function askGemini(mode) {
            const input = document.getElementById(`${mode}-chat-input`);
            const output = document.getElementById(`${mode}-chat-output`);
            const text = input.value.trim(); if(!text) return;

            const uDiv = document.createElement('div'); uDiv.className='user-msg chat-message'; uDiv.innerText=text;
            output.appendChild(uDiv); input.value=''; output.scrollTop = output.scrollHeight;

            const loading = document.createElement('div'); loading.className='ai-msg chat-message typing-indicator'; loading.innerText='...';
            output.appendChild(loading);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{parts: [{text: text}]}],
                        systemInstruction: {parts: [{text: SYSTEM_PROMPTS[mode]}]}
                    })
                });
                const data = await response.json();
                output.removeChild(loading);
                const aiDiv = document.createElement('div'); aiDiv.className='ai-msg chat-message';
                aiDiv.innerText = data.candidates[0].content.parts[0].text;
                output.appendChild(aiDiv);
                output.scrollTop = output.scrollHeight;
            } catch (e) { loading.innerText='Erro de conex√£o.'; }
        }

        // --- CHARTS ---
        new Chart(document.getElementById('mineralChart'), {
            type: 'bar', data: {
                labels: ['Prot√≥lito', 'Pico', 'Retro'],
                datasets: [{label: 'Granada %', data: [0, 25, 20], backgroundColor: '#B71C1C'}]
            }, options: {responsive: true, maintainAspectRatio: false}
        });
        new Chart(document.getElementById('ptPathChart'), {
            type: 'scatter', data: {
                datasets: [{label: 'Caminho P-T', data: [{x:400, y:3}, {x:800, y:7.5}, {x:700, y:4.5}], borderColor: '#B71C1C', showLine: true}]
            }, options: {responsive: true, maintainAspectRatio: false}
        });

        atualizarSimulacao();
    </script>
</body>
</html>
